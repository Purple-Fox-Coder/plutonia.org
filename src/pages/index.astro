---
import BaseLayout from "../layouts/BaseLayout.astro";
import NavBar from "../components/NavBar.astro";
import Footer from "../components/Footer.astro";
import ProjectCard from "../components/ProjectCard.astro";
import { Image } from 'astro:assets';

import LogoLarge from "../media/128x128.png";

const files = import.meta.glob('./projects/*/*.astro', { eager: true });

const projects = {};

for (const [path, mod] of Object.entries(files)) {
  const [, , projectName, fileName] = path.split('/');

  if (!projects[projectName]) {
    projects[projectName] = {
      project: null
    };
  }

  if (fileName === `${projectName}.astro`) {
    projects[projectName].project = mod;
    continue;
  }
}
---

<BaseLayout>
  <NavBar />

  <div class="mainBody">
    <ul>
      {Object.entries(projects).map(([name, data]) => {
        if (data.project?.meta?.isFeatured) {
          return (
            <li key={name}>
              <!-- Projects -->
              <ProjectCard
                title={data.project?.meta?.title ?? name}
                href={data.project.url}
                description={data.project?.meta?.description}
                image_src={LogoLarge.src}
              />
            </li>
          );
        } else {
          return null;
        }
      })}
    </ul>
  </div>

  <Footer />
</BaseLayout>
